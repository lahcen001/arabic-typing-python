<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary SEO Meta Tags -->
    <title>Arabizi - Free Arabic Transliterator & Typing Tool | Convert English to Arabic Online</title>
    <meta name="description" content="Free Arabic transliterator and typing tool. Convert English text to Arabic script instantly. Best Yamli alternative with smart suggestions, memory system, and copy history. Type Arabic easily online.">
    <meta name="keywords" content="arabizi, arabic transliterator, arabic typing, yamli alternative, english to arabic converter, arabic keyboard online, arabic text converter, free arabic typing tool, transliterate arabic, arabic script converter, online arabic typing, arabic input method, franco arabic, arabic chat typing, arabic social media typing">
    <meta name="author" content="Arabizi">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <link rel="canonical" href="https://arabizi.com/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://arabizi.com/">
    <meta property="og:title" content="Arabizi - Free Arabic Transliterator & Typing Tool">
    <meta property="og:description" content="Convert English text to Arabic script instantly. Free online Arabic typing tool with smart suggestions and memory system.">
    <meta property="og:image" content="https://arabizi.com/og-image.jpg">
    <meta property="og:site_name" content="Arabizi">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="ar_SA">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://arabizi.com/">
    <meta property="twitter:title" content="Arabizi - Free Arabic Transliterator & Typing Tool">
    <meta property="twitter:description" content="Convert English text to Arabic script instantly. Free online Arabic typing tool with smart suggestions.">
    <meta property="twitter:image" content="https://arabizi.com/twitter-image.jpg">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="application-name" content="Arabizi">
    <meta name="apple-mobile-web-app-title" content="Arabizi">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Language and Geographic Targeting -->
    <meta name="language" content="English">
    <meta name="geo.region" content="MENA">
    <meta name="geo.placename" content="Middle East, North Africa">
    
    <!-- Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Arabizi",
        "description": "Free Arabic transliterator and typing tool. Convert English text to Arabic script instantly with smart suggestions and memory system.",
        "url": "https://arabizi.com",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "English to Arabic transliteration",
            "Smart word suggestions",
            "Memory system for learning preferences",
            "Copy history tracking",
            "Multiple Arabic fonts",
            "Real-time conversion",
            "Mobile responsive design"
        ],
        "browserRequirements": "Requires JavaScript",
        "softwareVersion": "1.0",
        "datePublished": "2024-12-01",
        "creator": {
            "@type": "Organization",
            "name": "Arabizi"
        },
        "inLanguage": ["en", "ar"],
        "audience": {
            "@type": "Audience",
            "audienceType": "Arabic speakers, Arabic learners, Social media users"
        }
    }
    </script>
    
    <!-- Arabic Font Imports -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+Arabic:wght@100;200;300;400;500;600;700;800;900&family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" as="style">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, 'Cairo', 'Noto Sans Arabic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Arabic Background Decorations */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            z-index: -2;
        }

        body::after {
            content: '✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇ ✦ ❋ ✧ ◆ ◇';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-size: 2em;
            color: rgba(255, 255, 255, 0.03);
            z-index: -1;
            pointer-events: none;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-around;
            line-height: 1.5;
            animation: floatArabic 20s ease-in-out infinite;
            font-family: 'Amiri', 'Noto Sans Arabic', serif;
        }

        @keyframes floatArabic {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(1deg); }
            50% { transform: translateY(-5px) rotate(-1deg); }
            75% { transform: translateY(-15px) rotate(0.5deg); }
        }

        /* Geometric Islamic Patterns */
        .arabic-pattern {
            position: fixed;
            width: 200px;
            height: 200px;
            opacity: 0.05;
            z-index: -1;
            pointer-events: none;
        }

        .arabic-pattern-1 {
            top: 10%;
            left: 10%;
            background: radial-gradient(circle, transparent 30%, rgba(255, 255, 255, 0.1) 31%, rgba(255, 255, 255, 0.1) 40%, transparent 41%);
            border-radius: 50%;
            animation: rotate 30s linear infinite;
        }

        .arabic-pattern-2 {
            top: 20%;
            right: 15%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.08), transparent, rgba(255, 255, 255, 0.08), transparent);
            border-radius: 50%;
            animation: rotate 25s linear infinite reverse;
        }

        .arabic-pattern-3 {
            bottom: 15%;
            left: 20%;
            background: 
                linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.06) 41%, rgba(255, 255, 255, 0.06) 59%, transparent 60%),
                linear-gradient(-45deg, transparent 40%, rgba(255, 255, 255, 0.06) 41%, rgba(255, 255, 255, 0.06) 59%, transparent 60%);
            animation: rotate 35s linear infinite;
        }

        .arabic-pattern-4 {
            bottom: 25%;
            right: 10%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.08) 20%, transparent 21%, transparent 40%, rgba(255, 255, 255, 0.05) 41%, rgba(255, 255, 255, 0.05) 60%, transparent 61%);
            border-radius: 50%;
            animation: rotate 40s linear infinite reverse;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .container {
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            padding: 50px;
            max-width: 1000px;
            width: 100%;
            text-align: center;
            flex: 1;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        /* Footer */
        .footer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            max-width: 1000px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
            padding: 5px 10px;
        }

        .footer-links a:hover {
            color: #764ba2;
        }

        .footer-info {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .footer-keywords {
            margin-top: 10px;
            font-size: 0.8em;
            color: #999;
            line-height: 1.4;
        }

        .input-section {
            margin-bottom: 40px;
        }

        .input-group {
            position: relative;
            margin-bottom: 25px;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 25px;
            font-size: 1.3em;
            border: 3px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
            transition: all 0.3s ease;
            resize: vertical;
            font-family: 'Cairo', 'Noto Sans Arabic', 'Amiri', 'Arial', 'Tahoma', sans-serif;
            line-height: 1.8;
            direction: rtl;
            text-align: right;
            background: #fafafa;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        textarea::placeholder {
            font-family: 'Cairo', 'Noto Sans Arabic', 'Amiri', 'Arial', 'Tahoma', sans-serif;
            color: #999;
            direction: rtl;
            text-align: right;
        }

        textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.3), inset 0 2px 10px rgba(0, 0, 0, 0.05);
            background: white;
        }

        /* Suggestions Popup */
        .suggestions-popup {
            position: absolute;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 5px;
            min-width: 160px;
            max-width: 220px;
        }

        .suggestion-item {
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: #f8f9ff;
            color: #667eea;
        }

        .suggestion-item.selected {
            background: #667eea;
            color: white;
        }

        .suggestion-item.first-suggestion {
            background: #e8f2ff;
            border-left: 3px solid #667eea;
        }

        .suggestion-item.first-suggestion.selected {
            background: #667eea;
            color: white;
        }

        .suggestion-item.preferred-suggestion {
            background: #fff8e1;
            border-left: 3px solid #ffa726;
        }

        .suggestion-item.preferred-suggestion:hover {
            background: #fff3c4;
        }

        .suggestion-item.preferred-suggestion.selected {
            background: #ffa726;
            color: white;
        }

        .arabic-text {
            font-size: 1.1em;
            font-weight: bold;
            direction: rtl;
            font-family: 'Cairo', 'Noto Sans Arabic', 'Amiri', serif;
        }

        .suggestion-hint {
            font-size: 0.7em;
            color: #999;
        }

        .suggestion-item:hover .suggestion-hint {
            color: #667eea;
        }

        .suggestion-item.selected .suggestion-hint {
            color: rgba(255, 255, 255, 0.8);
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            margin: 0 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.clear-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .btn.clear-btn:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .loading {
            display: none;
            color: #667eea;
            font-style: italic;
        }

        /* Small Inline Loader */
        .inline-loader {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 5px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-text {
            background: linear-gradient(90deg, #fff3cd, #ffeaa7);
            padding: 2px 4px;
            border-radius: 3px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Double-click copy animation */
        .copy-success {
            background: linear-gradient(90deg, #d4edda, #c3e6cb) !important;
            transform: scale(1.02) !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.3) !important;
        }

        .examples {
            margin-top: 30px;
            text-align: center;
        }

        .example-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .example-btn {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .example-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .typing-indicator {
            position: absolute;
            left: 15px;
            top: 15px;
            color: #667eea;
            font-size: 0.9em;
            display: none;
        }

        .instructions {
            background: #e8f2ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #555;
        }

        .instructions strong {
            color: #667eea;
        }

        .word-counter {
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-size: 0.8em;
            color: #999;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .candidates {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }

            .suggestions-popup {
                max-height: 120px;
                min-width: 140px;
                max-width: 180px;
            }

            .suggestion-item {
                padding: 5px 10px;
                font-size: 0.8em;
            }

            .arabic-text {
                font-size: 0.95em;
            }

            .suggestion-hint {
                font-size: 0.6em;
            }

            .btn {
                margin: 5px;
                padding: 12px 30px;
            }

            .copy-notification {
                top: 10px;
                right: 10px;
                left: 10px;
                padding: 12px 20px;
                font-size: 0.9em;
                text-align: center;
                transform: translateY(-50px);
            }

            .copy-notification.show {
                transform: translateY(0);
            }

            .copy-notification.hide {
                transform: translateY(-50px);
            }

            .text-controls-top .control-row {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .text-controls-top .control-group {
                justify-content: space-between;
                width: 100%;
            }

            .text-controls-top .control-group:last-child {
                justify-content: center;
                gap: 10px;
            }

            .text-controls-top .control-group select {
                min-width: 80px;
                flex: 1;
                max-width: 120px;
            }

            .control-btn-small {
                min-width: 70px;
                padding: 8px 15px;
            }

            .loader {
                padding: 20px 25px;
                max-width: 250px;
                margin: 0 20px;
            }

            .loader h3 {
                font-size: 1.1em;
                margin-bottom: 15px;
            }

            .spinner {
                width: 40px;
                height: 40px;
                margin: 0 auto 10px;
            }

            .loader-text {
                font-size: 0.8em;
            }

            .arabic-calligraphy {
                display: none; /* Hide calligraphy on mobile for cleaner look */
            }

            /* Mobile adjustments for copy history */
            .copy-history-panel {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                max-height: 300px;
            }

            .history-toggle {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.1em;
            }

            .history-item {
                padding: 10px;
                margin-bottom: 6px;
            }

            .history-item-text {
                font-size: 0.85em;
                max-height: 50px;
                -webkit-line-clamp: 2;
            }

            .history-clear {
                font-size: 0.7em;
                padding: 4px 8px;
            }

            .history-controls {
                gap: 8px;
            }
        }

        /* Scrollbar styling for suggestions */
        .suggestions-popup::-webkit-scrollbar {
            width: 6px;
        }

        .suggestions-popup::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .suggestions-popup::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        /* Arabic text styling */
        .arabic {
            font-family: 'Cairo', 'Noto Sans Arabic', 'Amiri', serif;
            direction: rtl;
            text-align: right;
        }

        /* Text Controls Above Textarea */
        .text-controls-top {
            background: #f0f4ff;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 2px solid #e8f0ff;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .text-controls-top .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .text-controls-top .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .text-controls-top .control-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
            min-width: 50px;
        }

        .text-controls-top .control-group select {
            padding: 6px 10px;
            border: 2px solid #d0d7de;
            border-radius: 6px;
            background: white;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .text-controls-top .control-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .control-btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2);
            margin: 0 3px;
            min-width: 60px;
        }

        .control-btn-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .control-btn-small:active {
            transform: translateY(0);
        }

        /* Copy Animation */
        .copy-animation {
            animation: copyPulse 0.6s ease-in-out;
        }

        @keyframes copyPulse {
            0% {
                transform: scale(1);
                background: linear-gradient(135deg, #667eea, #764ba2);
            }
            50% {
                transform: scale(1.05);
                background: linear-gradient(135deg, #4CAF50, #45a049);
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            }
            100% {
                transform: scale(1);
                background: linear-gradient(135deg, #667eea, #764ba2);
            }
        }

        /* Copy success notification */
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            z-index: 10000;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .copy-notification.hide {
            opacity: 0;
            transform: translateX(100px);
        }

        /* Centered copy text popup */
        .copy-text-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
            z-index: 10001;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.4s ease;
            max-width: 80%;
            max-height: 60%;
            overflow-y: auto;
            text-align: center;
            font-weight: bold;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .copy-text-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .copy-text-popup.hide {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
        }

        .copy-text-popup .popup-header {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #fff;
        }

        .copy-text-popup .popup-text {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Cairo', 'Noto Sans Arabic', 'Amiri', serif;
            direction: rtl;
            text-align: right;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .copy-text-popup .popup-footer {
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Backdrop for popup */
        .copy-popup-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .copy-popup-backdrop.show {
            opacity: 1;
        }

        .copy-popup-backdrop.hide {
            opacity: 0;
        }

        /* Geometric Decorative Elements */
        .geometric-decoration {
            position: fixed;
            z-index: -1;
            pointer-events: none;
            opacity: 0.06;
        }

        .decoration-1 {
            top: 8%;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.1), transparent, rgba(255, 255, 255, 0.1), transparent);
            border-radius: 50%;
            animation: rotate 25s linear infinite;
        }

        .decoration-2 {
            bottom: 8%;
            right: 8%;
            width: 60px;
            height: 60px;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.08) 31%, rgba(255, 255, 255, 0.08) 69%, transparent 70%),
                linear-gradient(-45deg, transparent 30%, rgba(255, 255, 255, 0.08) 31%, rgba(255, 255, 255, 0.08) 69%, transparent 70%);
            animation: rotate 30s linear infinite reverse;
        }

        .decoration-3 {
            top: 50%;
            left: 8%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 20%, transparent 21%, transparent 40%, rgba(255, 255, 255, 0.06) 41%, rgba(255, 255, 255, 0.06) 60%, transparent 61%);
            border-radius: 50%;
            animation: rotate 35s linear infinite;
        }

        .decoration-4 {
            top: 15%;
            right: 20%;
            width: 40px;
            height: 40px;
            background: 
                linear-gradient(0deg, transparent 40%, rgba(255, 255, 255, 0.08) 41%, rgba(255, 255, 255, 0.08) 59%, transparent 60%),
                linear-gradient(90deg, transparent 40%, rgba(255, 255, 255, 0.08) 41%, rgba(255, 255, 255, 0.08) 59%, transparent 60%);
            animation: rotate 20s linear infinite reverse;
        }

        .decoration-5 {
            bottom: 20%;
            left: 15%;
            width: 70px;
            height: 70px;
            background: conic-gradient(from 45deg, transparent, rgba(255, 255, 255, 0.06), transparent, rgba(255, 255, 255, 0.06), transparent, rgba(255, 255, 255, 0.06), transparent);
            border-radius: 50%;
            animation: rotate 40s linear infinite;
        }

        /* Copy History Panel */
        .copy-history-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .copy-history-panel.show {
            opacity: 1;
            transform: translateX(0);
        }

        .copy-history-panel.hide {
            opacity: 0;
            transform: translateX(100%);
        }

        .history-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .history-clear {
            background: rgba(255, 107, 107, 0.8);
            border: none;
            color: white;
            font-size: 0.8em;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .history-clear:hover {
            background: rgba(255, 107, 107, 1);
            transform: scale(1.05);
        }

        .history-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .history-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .history-content {
            max-height: 320px;
            overflow-y: auto;
            padding: 10px;
        }

        .history-item {
            background: #f8f9ff;
            border: 1px solid #e8f0ff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-family: 'Cairo', 'Noto Sans Arabic', 'Amiri', serif;
            direction: rtl;
            text-align: right;
            line-height: 1.5;
        }

        .history-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-item-text {
            font-size: 0.9em;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .history-item-time {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 5px;
            text-align: left;
            direction: ltr;
        }

        .history-item:hover .history-item-time {
            opacity: 0.9;
        }

        .history-empty {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-style: italic;
        }

        /* History Toggle Button */
        .history-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            z-index: 1002;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .history-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .history-toggle.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }
    </style>
</head>
<body>
    <!-- Arabic Background Decorations -->
    <div class="arabic-pattern arabic-pattern-1"></div>
    <div class="arabic-pattern arabic-pattern-2"></div>
    <div class="arabic-pattern arabic-pattern-3"></div>
    <div class="arabic-pattern arabic-pattern-4"></div>
    
    <!-- Geometric Decorative Elements -->
    <div class="geometric-decoration decoration-1"></div>
    <div class="geometric-decoration decoration-2"></div>
    <div class="geometric-decoration decoration-3"></div>
    <div class="geometric-decoration decoration-4"></div>
    <div class="geometric-decoration decoration-5"></div>

    <!-- Copy History Toggle Button -->
    <button class="history-toggle" onclick="toggleCopyHistory()" title="Copy History">
        📋
    </button>

    <!-- Copy History Panel -->
    <div class="copy-history-panel" id="copyHistoryPanel">
        <div class="history-header">
            <span>📋 Copy History</span>
            <div class="history-controls">
                <button class="history-clear" onclick="clearCopyHistory()">🗑️ Clear</button>
                <button class="history-close" onclick="toggleCopyHistory()">×</button>
            </div>
        </div>
        <div class="history-content" id="historyContent">
            <div class="history-empty">No copied texts yet</div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🌙 Arabizi</h1>
            <p>Convert English/Franco-Arabic text to beautiful Arabic script</p>
        </div>

        <div class="instructions">
            <strong>💡 How to use:</strong> Type in English or Franco-Arabic (like "7abibi", "salam"). 
            Press <strong>Space or Enter</strong> to auto-select the first suggestion, or use arrow keys to navigate and Enter to select.
            <br><strong>📋 Paste & Go:</strong> Paste any Latin text and it will automatically transliterate to Arabic!
            <br><strong>🔄 Smart Auto-Convert:</strong> Text auto-transliterates when you press Space, Enter, click textarea, or select suggestions!
            <br><strong>📋 Quick Copy:</strong> Double-click anywhere on the textarea to instantly copy all text to clipboard!
            <br><strong>🕒 Copy History:</strong> Click the 📋 button (top-right) to access your last 10 copied texts anytime! Use 🗑️ Clear to delete history.
        </div>

        <div class="input-section">
            <!-- Text Controls Above Textarea -->
            <div class="text-controls-top">
                <div class="control-row">
                    <div class="control-group">
                        <label for="fontSelectTop">📝 Font:</label>
                        <select id="fontSelectTop" onchange="changeFontFamilyTop()">
                            <option value="Cairo">Cairo</option>
                            <option value="Noto Sans Arabic">Noto Sans Arabic</option>
                            <option value="Amiri">Amiri</option>
                            <option value="Arial">Arial</option>
                            <option value="Tahoma">Tahoma</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="fontSizeSelectTop">📏 Size:</label>
                        <select id="fontSizeSelectTop" onchange="changeFontSizeTop()">
                            <option value="1em">Small</option>
                            <option value="1.3em" selected>Medium</option>
                            <option value="1.6em">Large</option>
                            <option value="2em">Extra Large</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <button class="control-btn-small" onclick="copyAllText()">
                            📋 Copy
                        </button>
                        <button class="control-btn-small" onclick="printText()">
                            🖨️ Print
                        </button>
                        <button class="control-btn-small" onclick="downloadPDF()">
                            📄 PDF
                        </button>
                        <button class="control-btn-small" onclick="clearText()">
                            🗑️ Clear
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <textarea id="textInput" placeholder="ابدأ بكتابة النص هنا... (مثل: salam 7abibi, ahlan wa sahlan)"></textarea>
                <div class="typing-indicator" id="typingIndicator">⌨️</div>
                <div class="word-counter" id="wordCounter">0 words</div>
                <div class="suggestions-popup" id="suggestionsPopup"></div>
            </div>
            <div class="loading" id="loading">Getting suggestions...</div>
        </div>

        <div class="examples">
            <h3>Try these examples:</h3>
            <div class="example-buttons">
                <span class="example-btn" onclick="setExample('salam 7abibi')">salam 7abibi</span>
                <span class="example-btn" onclick="setExample('ahlan wa sahlan')">ahlan wa sahlan</span>
                <span class="example-btn" onclick="setExample('shukran jazeelan')">shukran jazeelan</span>
                <span class="example-btn" onclick="setExample('mabrook 3ala')">mabrook 3ala</span>
                <span class="example-btn" onclick="setExample('wa7da tneyn')">wa7da tneyn</span>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const loading = document.getElementById('loading');
        const suggestionsPopup = document.getElementById('suggestionsPopup');
        const typingIndicator = document.getElementById('typingIndicator');
        const wordCounter = document.getElementById('wordCounter');

        let currentSuggestions = [];
        let selectedSuggestionIndex = -1;
        let typingTimer;
        let isSelectingSuggestion = false;
        let currentWordStart = 0;
        let currentWordEnd = 0;
        let currentWord = '';
        
        // Memory system for user preferences
        let userPreferences = {};
        
        // Copy history system
        let copyHistory = [];
        const MAX_HISTORY_ITEMS = 10;
        
        // Load preferences from localStorage
        function loadUserPreferences() {
            try {
                const saved = localStorage.getItem('arabicTransliteratorPreferences');
                if (saved) {
                    userPreferences = JSON.parse(saved);
                }
            } catch (error) {
                console.log('Could not load user preferences');
                userPreferences = {};
            }
        }
        
        // Save preferences to localStorage
        function saveUserPreferences() {
            try {
                localStorage.setItem('arabicTransliteratorPreferences', JSON.stringify(userPreferences));
            } catch (error) {
                console.log('Could not save user preferences');
            }
        }
        
        // Record user selection for learning
        function recordUserSelection(latinWord, selectedArabic, allCandidates) {
            if (!latinWord || !selectedArabic) return;
            
            const key = latinWord.toLowerCase();
            
            if (!userPreferences[key]) {
                userPreferences[key] = {};
            }
            
            // Increment selection count for this Arabic option
            if (!userPreferences[key][selectedArabic]) {
                userPreferences[key][selectedArabic] = 0;
            }
            userPreferences[key][selectedArabic]++;
            
            // Save to localStorage
            saveUserPreferences();
        }
        
        // Reorder suggestions based on user preferences
        function reorderSuggestionsByPreference(latinWord, candidates) {
            if (!latinWord || !candidates || candidates.length === 0) {
                return candidates;
            }
            
            const key = latinWord.toLowerCase();
            const preferences = userPreferences[key];
            
            if (!preferences) {
                return candidates; // No preferences recorded yet
            }
            
            // Create array with preference scores
            const candidatesWithScores = candidates.map(candidate => ({
                text: candidate,
                score: preferences[candidate] || 0
            }));
            
            // Sort by preference score (highest first), then maintain original order for ties
            candidatesWithScores.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score; // Higher score first
                }
                // If scores are equal, maintain original order
                return candidates.indexOf(a.text) - candidates.indexOf(b.text);
            });
            
            return candidatesWithScores.map(item => item.text);
        }

        // Update word counter
        function updateWordCounter() {
            const text = textInput.value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            wordCounter.textContent = `${words} word${words !== 1 ? 's' : ''}`;
        }

        // Get current word being typed
        function getCurrentWord() {
            const text = textInput.value;
            const cursorPos = textInput.selectionStart;
            
            // Find word boundaries
            let start = cursorPos;
            let end = cursorPos;
            
            // Find start of current word
            while (start > 0 && !/\s/.test(text[start - 1])) {
                start--;
            }
            
            // Find end of current word
            while (end < text.length && !/\s/.test(text[end])) {
                end++;
            }
            
            currentWordStart = start;
            currentWordEnd = end;
            currentWord = text.substring(start, end);
            
            return currentWord;
        }

        // Position suggestions popup near current word
        function positionSuggestions() {
            const textRect = textInput.getBoundingClientRect();
            const textStyle = window.getComputedStyle(textInput);
            
            // Create a temporary element to measure text
            const measurer = document.createElement('div');
            measurer.style.cssText = `
                position: absolute;
                visibility: hidden;
                white-space: pre;
                font-family: ${textStyle.fontFamily};
                font-size: ${textStyle.fontSize};
                line-height: ${textStyle.lineHeight};
                padding: ${textStyle.padding};
                border: ${textStyle.border};
                direction: rtl;
                text-align: right;
            `;
            
            // Get text up to cursor position
            const textBeforeCursor = textInput.value.substring(0, textInput.selectionStart);
            const lines = textBeforeCursor.split('\n');
            const currentLine = lines[lines.length - 1];
            
            measurer.textContent = currentLine;
            document.body.appendChild(measurer);
            
            const textWidth = measurer.offsetWidth;
            const lineHeight = parseInt(textStyle.lineHeight) || 24;
            
            document.body.removeChild(measurer);
            
            // Calculate position (RTL aware) - position below cursor with offset
            const containerRect = textInput.parentElement.getBoundingClientRect();
            const leftOffset = Math.max(10, textRect.width - textWidth - 20);
            const topOffset = (lines.length - 1) * lineHeight + lineHeight + 25; // Increased from 10px to 25px offset
            
            suggestionsPopup.style.left = leftOffset + 'px';
            suggestionsPopup.style.top = topOffset + 'px';
        }

        // Auto-transliterate if there's remaining Latin text
        function autoTransliterateIfNeeded() {
            const text = textInput.value.trim();
            if (text.length > 0) {
                // Check if there's still Latin text that needs transliteration
                const hasLatinText = /[a-zA-Z0-9]/.test(text);
                if (hasLatinText) {
                    // Count words to avoid auto-transliterating single words being typed
                    const words = text.split(/\s+/).filter(word => word.trim().length > 0);
                    const latinWords = words.filter(word => /[a-zA-Z0-9]/.test(word));
                    
                    // Only auto-transliterate if there are multiple words or completed words
                    if (latinWords.length > 1 || (latinWords.length === 1 && text.endsWith(' '))) {
                        showNotification('🔄 Auto-transliterating remaining text...', 'info');
                        setTimeout(() => {
                            transliterateAll();
                        }, 200);
                    }
                }
            }
        }

        // Real-time suggestions as user types
        textInput.addEventListener('input', function(e) {
            updateWordCounter();
            const word = getCurrentWord().trim();
            
            if (word.length > 0 && !isSelectingSuggestion) {
                showTypingIndicator();
                clearTimeout(typingTimer);
                typingTimer = setTimeout(() => {
                    getSuggestions(word);
                }, 300); // Debounce for 300ms
            } else {
                hideSuggestions();
                hideTypingIndicator();
            }
            
            // Auto-transliterate on space after completing a word
            if (e.inputType === 'insertText' && e.data === ' ') {
                const text = textInput.value.trim();
                if (text.length > 0) {
                    const hasLatinText = /[a-zA-Z0-9]/.test(text);
                    if (hasLatinText) {
                        setTimeout(() => {
                            showNotification('⌨️ Space detected! Auto-transliterating...', 'info');
                            setTimeout(() => {
                                transliterateAll();
                            }, 200);
                        }, 100);
                    }
                }
            }
        });

        // Auto-transliterate on paste
        textInput.addEventListener('paste', function(e) {
            // Small delay to let the paste complete
            setTimeout(() => {
                const text = textInput.value.trim();
                if (text.length > 0) {
                    // Check if the pasted text contains Latin characters that might need transliteration
                    const hasLatinText = /[a-zA-Z0-9]/.test(text);
                    if (hasLatinText) {
                        // Show notification about auto-transliteration
                        showNotification('📋 Text pasted! Auto-transliterating...', 'info');
                        
                        // Auto-trigger transliteration after paste
                        setTimeout(() => {
                            transliterateAll();
                        }, 500); // Small delay to show the pasted text first
                    } else {
                        // Show notification for Arabic text
                        showNotification('📋 Arabic text pasted successfully!', 'success');
                    }
                }
            }, 100);
        });

        // Handle keyboard navigation and space for auto-selection
        textInput.addEventListener('keydown', function(e) {
            if (e.key === ' ' && currentSuggestions.length > 0) {
                // Always auto-select first suggestion on space, regardless of selection state
                e.preventDefault();
                selectSuggestion(currentSuggestions[0], true); // true = add space after
                return;
            }
            
            // Auto-transliterate on space when no suggestions are shown
            if (e.key === ' ' && currentSuggestions.length === 0) {
                const text = textInput.value.trim();
                if (text.length > 0) {
                    const hasLatinText = /[a-zA-Z0-9]/.test(text);
                    if (hasLatinText) {
                        // Don't prevent default - let space be added first
                        setTimeout(() => {
                            showNotification('⌨️ Space pressed! Auto-transliterating...', 'info');
                            setTimeout(() => {
                                transliterateAll();
                            }, 300);
                        }, 50);
                    }
                }
            }

            if (currentSuggestions.length === 0) {
                // Auto-transliterate on Enter key when no suggestions are shown
                if (e.key === 'Enter') {
                    setTimeout(() => {
                        autoTransliterateIfNeeded();
                    }, 100);
                }
                return;
            }

            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, currentSuggestions.length - 1);
                    updateSuggestionSelection();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);
                    updateSuggestionSelection();
                    break;
                case 'Enter':
                    e.preventDefault();
                    if (selectedSuggestionIndex >= 0) {
                        // Select the highlighted suggestion
                        selectSuggestion(currentSuggestions[selectedSuggestionIndex]);
                    } else {
                        // Select the first suggestion if none is highlighted
                        selectSuggestion(currentSuggestions[0]);
                    }
                    break;
                case 'Escape':
                    hideSuggestions();
                    break;
            }
        });

        // Update cursor position tracking
        textInput.addEventListener('click', function() {
            // Add space when clicking on textarea (if there's text and cursor is at the end)
            const cursorPos = textInput.selectionStart;
            const text = textInput.value;
            
            if (text.length > 0 && cursorPos === text.length && !text.endsWith(' ')) {
                textInput.value += ' ';
                textInput.setSelectionRange(text.length + 1, text.length + 1);
                updateWordCounter();
            }
            
            // Auto-transliterate on click if there's Latin text
            if (text.trim().length > 0) {
                const hasLatinText = /[a-zA-Z0-9]/.test(text);
                if (hasLatinText) {
                    showNotification('🖱️ Click detected! Auto-transliterating...', 'info');
                    setTimeout(() => {
                        transliterateAll();
                    }, 300);
                }
            }
            
            setTimeout(() => {
                const word = getCurrentWord().trim();
                if (word.length > 0) {
                    getSuggestions(word);
                } else {
                    hideSuggestions();
                }
            }, 10);
        });

        // Double-click to copy all text
        textInput.addEventListener('dblclick', function(e) {
            e.preventDefault(); // Prevent text selection
            
            const text = textInput.value;
            if (!text.trim()) {
                showNotification('No text to copy! ❌', 'error');
                return;
            }
            
            // Copy text to clipboard
            navigator.clipboard.writeText(text).then(() => {
                addToCopyHistory(text); // Add to history
                showCopyTextPopup(text);
                
                // Add visual feedback to textarea
                textInput.classList.add('copy-success');
                
                setTimeout(() => {
                    textInput.classList.remove('copy-success');
                }, 600);
                
            }).catch(() => {
                // Fallback for older browsers
                textInput.select();
                document.execCommand('copy');
                addToCopyHistory(text); // Add to history
                showCopyTextPopup(text);
                
                // Add visual feedback
                textInput.classList.add('copy-success');
                setTimeout(() => {
                    textInput.classList.remove('copy-success');
                }, 600);
            });
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.input-group')) {
                hideSuggestions();
            }
        });

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        async function getSuggestions(word) {
            try {
                const response = await fetch('/transliterate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ word: word })
                });

                const data = await response.json();
                hideTypingIndicator();

                if (data.success && data.candidates && data.candidates.length > 0) {
                    showSuggestions(data.candidates, word);
                } else {
                    hideSuggestions();
                }
            } catch (error) {
                hideTypingIndicator();
                hideSuggestions();
            }
        }

        function showSuggestions(candidates, originalWord) {
            // Reorder candidates based on user preferences
            const reorderedCandidates = reorderSuggestionsByPreference(originalWord, candidates);
            currentSuggestions = reorderedCandidates;
            selectedSuggestionIndex = -1;
            
            let html = '';
            reorderedCandidates.slice(0, 8).forEach((candidate, index) => { // Show max 8 suggestions
                const isFirst = index === 0;
                const isPreferred = userPreferences[originalWord.toLowerCase()] && 
                                  userPreferences[originalWord.toLowerCase()][candidate] > 0;
                html += `
                    <div class="suggestion-item ${isFirst ? 'first-suggestion' : ''} ${isPreferred ? 'preferred-suggestion' : ''}" onclick="selectSuggestion('${candidate}')" data-index="${index}">
                        <span class="arabic-text">${candidate}</span>
                        <span class="suggestion-hint">${isFirst ? 'Space to select' : 'Click to select'}${isPreferred ? ' ⭐' : ''}</span>
                    </div>
                `;
            });

            suggestionsPopup.innerHTML = html;
            positionSuggestions();
            suggestionsPopup.style.display = 'block';
        }

        function hideSuggestions() {
            suggestionsPopup.style.display = 'none';
            currentSuggestions = [];
            selectedSuggestionIndex = -1;
        }

        function updateSuggestionSelection() {
            const items = suggestionsPopup.querySelectorAll('.suggestion-item');
            items.forEach((item, index) => {
                if (index === selectedSuggestionIndex) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        function selectSuggestion(arabicText, addSpace = false) {
            isSelectingSuggestion = true;
            
            // Record this selection for learning (store the original Latin word)
            if (currentWord && currentWord.trim()) {
                recordUserSelection(currentWord.trim(), arabicText, currentSuggestions);
            }
            
            // Get current cursor position and text
            const cursorPos = textInput.selectionStart;
            const text = textInput.value;
            
            // Find the exact word boundaries more precisely
            let wordStart = cursorPos;
            let wordEnd = cursorPos;
            
            // Move backward to find start of word (stop at space, newline, or start of text)
            while (wordStart > 0 && !/[\s\n]/.test(text[wordStart - 1])) {
                wordStart--;
            }
            
            // Move forward to find end of word (stop at space, newline, or end of text)
            while (wordEnd < text.length && !/[\s\n]/.test(text[wordEnd])) {
                wordEnd++;
            }
            
            // Replace the entire word with Arabic text
            const beforeWord = text.substring(0, wordStart);
            const afterWord = text.substring(wordEnd);
            const newText = beforeWord + arabicText + (addSpace ? ' ' : '') + afterWord;
            
            textInput.value = newText;
            
            // Position cursor after the inserted Arabic text
            const newCursorPos = wordStart + arabicText.length + (addSpace ? 1 : 0);
            textInput.setSelectionRange(newCursorPos, newCursorPos);
            
            hideSuggestions();
            updateWordCounter();
            
            // Auto-transliterate remaining Latin text after suggestion selection
            setTimeout(() => {
                autoTransliterateIfNeeded();
            }, 300);
            
            setTimeout(() => {
                isSelectingSuggestion = false;
                textInput.focus();
            }, 100);
        }

        function setExample(text) {
            textInput.value = text;
            textInput.focus();
            updateWordCounter();
            // Position cursor at end
            textInput.setSelectionRange(text.length, text.length);
        }

        function clearText() {
            textInput.value = '';
            textInput.focus();
            updateWordCounter();
            hideSuggestions();
        }

        async function transliterateAll() {
            const text = textInput.value.trim();
            
            if (!text) {
                showNotification('Please enter some text to transliterate! ❌', 'error');
                return;
            }

            // Show notification and add inline loaders
            showNotification('🔄 Transliterating text...', 'info');
            hideSuggestions();

            try {
                const words = text.split(/\s+/);
                let currentText = text;
                
                // Add loaders to Latin words
                for (let i = 0; i < words.length; i++) {
                    const word = words[i];
                    if (word.trim() && /[a-zA-Z0-9]/.test(word)) {
                        const loaderHTML = `<span class="processing-text">${word}<span class="inline-loader"></span></span>`;
                        currentText = currentText.replace(word, loaderHTML);
                    }
                }
                
                // Temporarily show text with loaders (using innerHTML simulation)
                const originalValue = textInput.value;
                textInput.style.background = 'linear-gradient(90deg, #fff9e6, #ffeaa7)';
                
                const translatedWords = [];
                
                for (const word of words) {
                    if (word.trim()) {
                        if (/[a-zA-Z0-9]/.test(word)) {
                            const response = await fetch('/transliterate', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ word: word.trim() })
                            });

                            const data = await response.json();
                            if (data.success && data.best_match) {
                                translatedWords.push(data.best_match);
                            } else {
                                translatedWords.push(word); // Keep original if no translation
                            }
                        } else {
                            translatedWords.push(word); // Keep Arabic words as is
                        }
                    }
                }

                // Replace text in textarea
                textInput.value = translatedWords.join(' ');
                textInput.style.background = ''; // Reset background
                updateWordCounter();
                textInput.focus();
                
                showNotification('✨ Text transliterated successfully!', 'success');
                
            } catch (error) {
                textInput.style.background = ''; // Reset background on error
                showNotification('Network error: ' + error.message + ' ❌', 'error');
            }
        }

        // Initialize
        window.onload = function() {
            textInput.focus();
            updateWordCounter();
            loadUserPreferences();
            loadCopyHistory();
        };

        // Font and text control functions
        function changeFontFamily() {
            const fontSelect = document.getElementById('fontSelect');
            const selectedFont = fontSelect.value;
            textInput.style.fontFamily = `'${selectedFont}', 'Cairo', 'Noto Sans Arabic', 'Amiri', serif`;
        }

        function changeFontSize() {
            const fontSizeSelect = document.getElementById('fontSizeSelect');
            const selectedSize = fontSizeSelect.value;
            textInput.style.fontSize = selectedSize;
        }

        // Top controls functions (above textarea)
        function changeFontFamilyTop() {
            const fontSelectTop = document.getElementById('fontSelectTop');
            const selectedFont = fontSelectTop.value;
            textInput.style.fontFamily = `'${selectedFont}', 'Cairo', 'Noto Sans Arabic', 'Amiri', serif`;
        }

        function changeFontSizeTop() {
            const fontSizeSelectTop = document.getElementById('fontSizeSelectTop');
            const selectedSize = fontSizeSelectTop.value;
            textInput.style.fontSize = selectedSize;
        }

        function copyAllText() {
            const text = textInput.value;
            if (!text.trim()) {
                showNotification('No text to copy! ❌', 'error');
                return;
            }
            
            const copyBtn = document.querySelector('.control-btn-small[onclick="copyAllText()"]');
            
            // Add animation to button
            if (copyBtn) {
                copyBtn.classList.add('copy-animation');
            }
            
            navigator.clipboard.writeText(text).then(() => {
                addToCopyHistory(text); // Add to history
                showNotification('Text copied to clipboard! 📋✨', 'success');
            }).catch(() => {
                // Fallback for older browsers
                textInput.select();
                document.execCommand('copy');
                addToCopyHistory(text); // Add to history
                showNotification('Text copied to clipboard! 📋✨', 'success');
            });
            
            // Remove animation class after animation completes
            if (copyBtn) {
                setTimeout(() => {
                    copyBtn.classList.remove('copy-animation');
                }, 600);
            }
        }

        function showNotification(message, type = 'success') {
            // Remove existing notification if any
            const existingNotification = document.querySelector('.copy-notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'copy-notification';
            notification.textContent = message;
            
            // Add type-specific styling
            if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #ff6b6b, #ee5a52)';
            } else if (type === 'info') {
                notification.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            }
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        function printText() {
            const text = textInput.value;
            if (!text.trim()) {
                alert('No text to print!');
                return;
            }

            const printWindow = window.open('', '_blank');
            const fontFamily = textInput.style.fontFamily || "'Cairo', 'Noto Sans Arabic', 'Amiri', serif";
            const fontSize = textInput.style.fontSize || '1.3em';
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Arabic Text - Print</title>
                    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+Arabic:wght@100;200;300;400;500;600;700;800;900&family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
                    <style>
                        body {
                            font-family: ${fontFamily};
                            font-size: ${fontSize};
                            line-height: 1.8;
                            direction: rtl;
                            text-align: right;
                            padding: 20px;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        @media print {
                            body { margin: 0; padding: 15px; }
                        }
                    </style>
                </head>
                <body>
                    <div>${text.replace(/\n/g, '<br>')}</div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        function downloadPDF() {
            const text = textInput.value;
            if (!text.trim()) {
                alert('No text to download!');
                return;
            }

            // Create a simple PDF using jsPDF (we'll add the library)
            // For now, we'll create a simple HTML file that can be saved as PDF
            const fontFamily = textInput.style.fontFamily || "'Cairo', 'Noto Sans Arabic', 'Amiri', serif";
            const fontSize = textInput.style.fontSize || '1.3em';
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Arabic Text Document</title>
                    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+Arabic:wght@100;200;300;400;500;600;700;800;900&family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
                    <style>
                        body {
                            font-family: ${fontFamily};
                            font-size: ${fontSize};
                            line-height: 1.8;
                            direction: rtl;
                            text-align: right;
                            padding: 40px;
                            max-width: 800px;
                            margin: 0 auto;
                            background: white;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #667eea;
                            padding-bottom: 20px;
                        }
                        .content {
                            white-space: pre-wrap;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>📄 Arabic Text Document</h1>
                        <p>Generated on ${new Date().toLocaleDateString()}</p>
                    </div>
                    <div class="content">${text}</div>
                </body>
                </html>
            `;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'arabic-text-document.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('HTML file downloaded! You can open it in a browser and save as PDF. 📄');
        }

        function showCopyTextPopup(text) {
            // Create backdrop
            const backdrop = document.createElement('div');
            backdrop.className = 'copy-popup-backdrop';
            document.body.appendChild(backdrop);
            
            // Create popup
            const popup = document.createElement('div');
            popup.className = 'copy-text-popup';
            popup.innerHTML = `
                <div class="popup-header">📋 Text Copied to Clipboard!</div>
                <div class="popup-text">${text.replace(/\n/g, '<br>')}</div>
                <div class="popup-footer">✨ Double-click detected! Text successfully copied ✨</div>
            `;
            document.body.appendChild(popup);
            
            // Show backdrop and popup
            setTimeout(() => {
                backdrop.classList.add('show');
                popup.classList.add('show');
            }, 10);
            
            // Auto-close after 3 seconds
            setTimeout(() => {
                hideCopyTextPopup();
            }, 3000);
            
            // Close on backdrop click
            backdrop.onclick = function() {
                hideCopyTextPopup();
            };
            
            // Close on popup click (optional)
            popup.onclick = function() {
                hideCopyTextPopup();
            };
        }

        function hideCopyTextPopup() {
            const popup = document.querySelector('.copy-text-popup');
            const backdrop = document.querySelector('.copy-popup-backdrop');
            
            if (popup) {
                popup.classList.remove('show');
                popup.classList.add('hide');
            }
            
            if (backdrop) {
                backdrop.classList.remove('show');
                backdrop.classList.add('hide');
            }
            
            setTimeout(() => {
                if (popup && popup.parentNode) {
                    popup.remove();
                }
                if (backdrop && backdrop.parentNode) {
                    backdrop.remove();
                }
            }, 400);
        }

        function toggleCopyHistory() {
            const copyHistoryPanel = document.getElementById('copyHistoryPanel');
            if (copyHistoryPanel.classList.contains('show')) {
                copyHistoryPanel.classList.remove('show');
                copyHistoryPanel.classList.add('hide');
            } else {
                copyHistoryPanel.classList.remove('hide');
                copyHistoryPanel.classList.add('show');
            }
        }

        // Load copy history from localStorage
        function loadCopyHistory() {
            try {
                const saved = localStorage.getItem('arabizoCopyHistory');
                if (saved) {
                    copyHistory = JSON.parse(saved);
                }
            } catch (error) {
                console.log('Could not load copy history');
                copyHistory = [];
            }
            updateHistoryDisplay();
        }
        
        // Save copy history to localStorage
        function saveCopyHistory() {
            try {
                localStorage.setItem('arabizoCopyHistory', JSON.stringify(copyHistory));
            } catch (error) {
                console.log('Could not save copy history');
            }
        }
        
        // Add text to copy history
        function addToCopyHistory(text) {
            if (!text || !text.trim()) return;
            
            const trimmedText = text.trim();
            
            // Remove if already exists (to move to top)
            copyHistory = copyHistory.filter(item => item.text !== trimmedText);
            
            // Add to beginning
            copyHistory.unshift({
                text: trimmedText,
                timestamp: new Date().toLocaleString(),
                id: Date.now()
            });
            
            // Keep only last 10 items
            if (copyHistory.length > MAX_HISTORY_ITEMS) {
                copyHistory = copyHistory.slice(0, MAX_HISTORY_ITEMS);
            }
            
            saveCopyHistory();
            updateHistoryDisplay();
        }
        
        // Update history display
        function updateHistoryDisplay() {
            const historyContent = document.getElementById('historyContent');
            
            if (copyHistory.length === 0) {
                historyContent.innerHTML = '<div class="history-empty">No copied texts yet</div>';
                return;
            }
            
            let html = '';
            copyHistory.forEach((item, index) => {
                html += `
                    <div class="history-item" onclick="copyFromHistory('${item.id}')">
                        <div class="history-item-text">${item.text}</div>
                        <div class="history-item-time">${item.timestamp}</div>
                    </div>
                `;
            });
            
            historyContent.innerHTML = html;
        }
        
        // Copy text from history
        function copyFromHistory(itemId) {
            const item = copyHistory.find(h => h.id == itemId);
            if (!item) return;
            
            navigator.clipboard.writeText(item.text).then(() => {
                showNotification('📋 Text copied from history! ✨', 'success');
                
                // Move this item to top of history
                addToCopyHistory(item.text);
                
            }).catch(() => {
                // Fallback for older browsers
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = item.text;
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextarea);
                
                showNotification('📋 Text copied from history! ✨', 'success');
                addToCopyHistory(item.text);
            });
        }

        function clearCopyHistory() {
            if (copyHistory.length === 0) {
                showNotification('History is already empty! 📭', 'info');
                return;
            }
            
            if (confirm('Are you sure you want to clear all copy history? This action cannot be undone.')) {
                copyHistory = [];
                saveCopyHistory();
                updateHistoryDisplay();
                showNotification('🗑️ Copy history cleared successfully!', 'success');
            }
        }
    </script>
    
    <!-- Footer Section for SEO -->
    <footer class="footer">
        <div class="footer-links">
            <a href="/terms">Terms & Conditions</a>
            <a href="/privacy">Privacy Policy</a>
            <a href="https://github.com/lahcen001/arabic-typing-python" target="_blank" rel="noopener">GitHub</a>
            <a href="#" onclick="showNotification('Contact us via GitHub for support! 📧', 'info')">Contact</a>
        </div>
        
        <div class="footer-info">
            <p><strong>🌙 Arabizi</strong> - Free Arabic Transliterator & Typing Tool</p>
            <p>Convert English text to Arabic script instantly with smart suggestions and memory system.</p>
            <p>Best alternative to Yamli for Arabic typing online. No registration required.</p>
        </div>
        
        <div class="footer-keywords">
            <p><small>
                Arabic transliterator • Yamli alternative • English to Arabic converter • Arabic keyboard online • 
                Arabic typing tool • Franco Arabic • Arabic chat typing • Online Arabic input • 
                Arabic script converter • Free Arabic typing • Arabic social media typing • 
                Arabic text converter • Transliterate Arabic • Arabic input method • 
                Arabic writing tool • Online Arabic keyboard • Arabic typing software
            </small></p>
        </div>
    </footer>
</body>
</html> 